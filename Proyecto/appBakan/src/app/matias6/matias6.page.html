<ion-header translucent="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/ficha/p001" text=""></ion-back-button>
    </ion-buttons>
    <ion-title>Historial</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content fullscreen>
  <div class="page">
    <h1 class="page-title">Historial de intervenciones</h1>

    <!-- Filtros -->
    <ion-card class="section card">
      <ion-card-header>
        <ion-card-title>Filtros</ion-card-title>
        <ion-card-subtitle class="k">Refina la búsqueda por fecha y texto</ion-card-subtitle>
      </ion-card-header>
      <ion-card-content>
        <ion-list lines="none">
          <ion-item class="item">
            <ion-label position="stacked">Buscar</ion-label>
            <ion-searchbar
              placeholder="Diagnóstico, procedimiento, lugar o notas"
              [(ngModel)]="filtros.texto"
              (ionInput)="aplicarFiltros()">
            </ion-searchbar>
          </ion-item>

          <ion-item class="item">
            <ion-label position="stacked">Desde</ion-label>
            <ion-datetime
              presentation="date"
              [(ngModel)]="filtros.desde"
              (ionChange)="aplicarFiltros()">
            </ion-datetime>
          </ion-item>

          <ion-item class="item">
            <ion-label position="stacked">Hasta</ion-label>
            <ion-datetime
              presentation="date"
              [(ngModel)]="filtros.hasta"
              (ionChange)="aplicarFiltros()">
            </ion-datetime>
          </ion-item>

          <ion-item class="item">
            <ion-label position="stacked">Ordenar</ion-label>
            <ion-segment [(ngModel)]="filtros.ordenar" (ionChange)="aplicarFiltros()">
              <ion-segment-button value="recientes">
                <ion-label>Recientes</ion-label>
              </ion-segment-button>
              <ion-segment-button value="antiguos">
                <ion-label>Antiguos</ion-label>
              </ion-segment-button>
            </ion-segment>
          </ion-item>
        </ion-list>

        <div class="actions">
          <ion-button fill="outline" (click)="limpiarFiltros()">
            Limpiar filtros
          </ion-button>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Lista de historial -->
    <ion-card class="section card">
      <ion-card-header>
        <ion-card-title>Atenciones</ion-card-title>
        <ion-card-subtitle class="k">Resultados: {{ listaFiltrada.length }}</ion-card-subtitle>
      </ion-card-header>
      <ion-card-content>
        <ion-list lines="full">
          <ion-item class="item" *ngFor="let h of listaFiltrada">
            <ion-label>
              <h2>{{ h.diagnostico }}</h2>
              <p class="k">{{ h.procedimiento }} · {{ h.lugar }}</p>
              <p class="k">{{ h.fecha }} {{ h.hora }}</p>
              <p *ngIf="h.notas">{{ h.notas }}</p>
            </ion-label>
          </ion-item>

          <ion-item class="item" *ngIf="listaFiltrada.length === 0">
            <ion-label class="k">No hay registros que coincidan con los filtros.</ion-label>
          </ion-item>
        </ion-list>
      </ion-card-content>
    </ion-card>

    <!-- Accesos rápidos -->
    <ion-grid class="grid-cards">
      <ion-row>
        <ion-col size="6">
          <ion-card button [routerLink]="['/matias4']">
            <ion-card-content class="ion-text-center">
              <ion-icon name="medkit-outline"></ion-icon><br>
              Medicamentos
            </ion-card-content>
          </ion-card>
        </ion-col>
        <ion-col size="6">
          <ion-card button [routerLink]="['/matias7']">
            <ion-card-content class="ion-text-center">
              <ion-icon name="grid-outline"></ion-icon><br>
              Dashboard
            </ion-card-content>
          </ion-card>
        </ion-col>
      </ion-row>
    </ion-grid>
  </div>
</ion-content>
