<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>Busqueda básica</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content 
  [fullscreen]="true" 
  class="fondo"
  [scrollEvents]="true" 
  (ionScroll)="onScroll($event)">

  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">Pacientes</ion-title>
    </ion-toolbar>
  </ion-header>

  <ion-breadcrumbs>
    <ion-breadcrumb expand="block" (click)="irAHome()">Cerrar sesión</ion-breadcrumb>
    <ion-breadcrumb (click)="irAMartin3()">Volver</ion-breadcrumb>
  </ion-breadcrumbs>

  <div class="searchbar">
    <ion-searchbar
      color="medium"
      placeholder="Buscar por nombre o RUT"
      [debounce]="300"
      [value]="searchTerm"
      (ionInput)="onBuscar($event)"
      (ionClear)="onBuscar({detail: {value: ''}})">
    </ion-searchbar>
  </div>

  <div class="scroll">
    <!-- Loading spinner -->
    <div *ngIf="isLoading" class="loading-container">
      <ion-spinner name="crescent"></ion-spinner>
      <p>Cargando pacientes...</p>
    </div>

    <!-- Patient list -->
    <ion-list *ngIf="!isLoading">
      <ion-item 
        *ngFor="let paciente of filteredPacientes"
        (click)="verPaciente(paciente)"
        button>
        <ion-avatar slot="start">
          <img [src]="'https://picsum.photos/80/80?random=' + paciente['idpaciente']" alt="avatar" />
        </ion-avatar>
        <ion-label>
          <h2>{{ paciente['nombrePaciente'] }}</h2>
          <p>{{ paciente['rut'] }}</p>
          <p *ngIf="paciente['sexo']" class="patient-info">Sexo: {{ paciente['sexo'] }}</p>
          <p *ngIf="paciente['fechaNacimiento']" class="patient-info">
            Nacimiento: {{ paciente['fechaNacimiento'] | date:'dd/MM/yyyy' }}
          </p>
          <p *ngIf="paciente['direccion']" class="patient-info">
            Dirección: {{ paciente['direccion'] }}
          </p>
        </ion-label>
      </ion-item>

      <!-- No results message -->
      <ion-item *ngIf="filteredPacientes.length === 0 && !isLoading">
        <ion-label>
          <h2 *ngIf="!isSearching">No hay pacientes registrados</h2>
          <h2 *ngIf="isSearching">No se encontraron pacientes</h2>
          <p *ngIf="searchTerm && isSearching">No hay resultados para "{{ searchTerm }}"</p>
          <p *ngIf="isSearching">Intenta buscar por nombre completo o RUT (con o sin puntos y guión)</p>
        </ion-label>
      </ion-item>
    </ion-list>

    <!-- Infinite scroll (only show when not searching) -->
    <ion-infinite-scroll 
      *ngIf="!isSearching"
      threshold="100px" 
      (ionInfinite)="cargarMasPacientes($event)">
      <ion-infinite-scroll-content
        loadingSpinner="bubbles"
        loadingText="Cargando más pacientes...">
      </ion-infinite-scroll-content>
    </ion-infinite-scroll>
  </div>

  <!-- Botón "Subir al tope" -->
  
  <ion-fab vertical="bottom" horizontal="end" slot="fixed" *ngIf="showScrollTop">
    <ion-fab-button (click)="scrollToTop()">
      <ion-icon name="arrow-up-outline"></ion-icon>
    </ion-fab-button>
  </ion-fab>
  

  <!-- Toast -->
  <ion-toast
    [isOpen]="showToast"
    [message]="toastMessage"
    [color]="toastColor"
    [duration]="3000"
    (didDismiss)="onToastDismiss()">
  </ion-toast>
</ion-content>
